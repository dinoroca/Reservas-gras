<app-nav></app-nav>

<div class="container py-5">
  <div class="shadow rounded mt-5 p-4">
    <div class="row">
      <div class="col-sm-3 col-12 mt-3">
        <app-sidebar></app-sidebar>
      </div>
      <!-- mis pagos -->
      <div class="col-sm-9 col-12 mt-3">
        <h3 class="text-center fw-bold py-4" style="color:rgb(6, 170, 115)">MIS RESERVACIONES</h3>
        <!-- Body -->
        <div class="">

          <div class="flex-fill border-box d-none d-lg-block"
            style="width: 5%; border-left: 1px solid rgb(6, 170, 115);">
          </div>

          <div *ngIf="load_data">
            <!-- Custom size border spinner -->
            <div class="text-center">
              <div class="spinner-border" style="width: 3rem; height: 3rem" role="status">
              </div>
              <h5 class="text-black-50"><small>Cargando...</small></h5>
            </div>
          </div>

          <ng-container *ngIf="fromOut && !load_data">
            <div class="card">
              <div class="card-body">
                <div class="text-center">
                  <h4> {{cancha.nombre}} <span class="fw-light fs-5">del</span> {{cancha.empresa.nombre}} </h4>
                  <span class="fw-light"> {{cancha.empresa.direccion}} </span>

                  <h4> </h4>

                </div>

                <div class="row py-2">
                  <div class="col-12 col-sm-4"> <i class="bi bi-person fs-4" style="color:rgb(0, 192, 86);"></i> 
                    &nbsp; {{user_lc.nombres}} 
                  </div>
                  <div class="col-12 col-sm-4"><i class="bi bi-calendar-event fs-4" style="color:rgb(0, 192, 86);"></i> 
                    &nbsp; {{fecha}} 
                  </div>
                  <div class="col-12 col-sm-4"> <i class="bi bi-clock fs-4" style="color:rgb(0, 192, 86);"></i> 
                    &nbsp; {{horaInicio}}:00 a {{horaFin}}:00
                  </div>
                </div>

                <div class="text-center my-1">
                  <p class="fw-light m-0"> Subtotal </p>
                  <span style="color:rgb(0, 192, 86); font-size: 3rem;" class="fw-light"> S/. {{subtotal}} </span>
                </div>

                <div class="text-center">
                  <button type="button" class="btn btn-sm px-4" (click)="crear_reservacion()"
                  style="background-color:rgb(0, 192, 86); color: #fff; border-radius: 15px;">
                    Confirmar
                  </button>
                </div>

              </div>
            </div>
          </ng-container>

          <div>
            <div class="shadow card rounded my-4" *ngFor="let item of pagos; let indice = index"
              style="border: 1px solid rgb(111, 66, 193);">
              <div class="card-body py-1">
                <div class="d-flex flex-wrap justify-content-between py-3" data-toggle="collapse" aria-expanded="false">
                  <span class="pr-2 fw-bold">N°. {{pagos.length - indice}} </span>

                  <span class="text-muted" *ngIf="item.estado == 'Reservado'">
                    <i class="bi bi-calendar"></i> &nbsp;
                    {{item.createdAt | date}}
                  </span>

                  <span class="text-muted" *ngIf="item.estado == 'Confirmado'">
                    <i class="bi bi-calendar"></i> &nbsp;
                    {{item.vencimiento | date}} <small>(finaliza)</small>
                  </span>

                  <span class="text-muted" *ngIf="item.estado == 'Vencido'">
                    <i class="bi bi-calendar"></i> &nbsp;
                    {{item.vencimiento | date}} <small class="text-danger">(vencido)</small>
                  </span>

                  <span class="badge rounded-pill bg-secondary" *ngIf="item.estado == 'Reservado'"> {{item.estado}}
                  </span>
                  <span class="badge rounded-pill bg-success" *ngIf="item.estado == 'Confirmado'"> {{item.estado}}
                  </span>
                  <span class="badge rounded-pill bg-danger" *ngIf="item.estado == 'Vencido'"> {{item.estado}}
                  </span>
                  <span class="text-dark pl-1">S/. {{item.subtotal}} </span>
                </div>

                <div class="text-center mb-3">
                  <!-- Button trigger modal -->
                  <button type="button" class="btn btn-light btn-sm" data-bs-toggle="modal"
                    [attr.data-bs-target]="'#view-' + item._id">
                    <i class="bi bi-eye-fill"></i> &nbsp; Ver detalles
                  </button>
                </div>

                <div class="card px-2 mb-3" *ngIf="item.estado == 'Reservado'">
                  <div class="text-center">
                    <strong class="fw-bold text-danger">Recuerde: </strong> Realizar un pago de

                    A una de las siguientes cuentas y enviar el código "<strong>{{item._id}}</strong>"
                    así como el comprobante de la operación al Whatsapp:
                    <a href="https://wa.me/51928899925" target="_blank" style="text-decoration: none; cursor: pointer;">
                      <strong>+51 928 899 925</strong>
                    </a>
                    o al correo: <a href="mailto:ingresayaa@gmail.com" target="_blank"
                      style="text-decoration: none; cursor: pointer;">
                      <strong>ingresaYAA&#64;gmail.com</strong>
                    </a>.
                  </div>

                  <div class="" *ngIf="!load_data">
                    <ng-container *ngFor="let item of cuentas">
                      <div class="shadow rounded px-3 my-3 py-3" [ngStyle]="{'background-color': item.color}">
                        <div class="row pt-3">
                          <div class="text-center">
                            <h5 class="fw-bold">
                              {{item.banco}}
                            </h5>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md-4 col-12">
                            <span class="badge rounded-pill text-bg-light"><strong>Titular: </strong>
                              {{item.titular}}</span>
                          </div>

                          <div class="col-md-4 col-12">
                            <span class="fs-6 mx-3"> <strong>Cuenta: </strong> {{item.cuenta}}</span>
                          </div>

                          <div class="col-md-4 col-12">
                            <span class="fs-6 mx-3"> <strong>CCI: </strong> {{item.cci}}</span>
                          </div>
                        </div>
                      </div>

                    </ng-container>
                  </div>
                </div>

                <!-- Modal -->
                <div class="modal fade" id="view-{{ item._id }}" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Detalles del <strong>Pago N°.
                            {{pagos.length - indice}}</strong></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body table-responsive">
                        <table class="table table-borderless">
                          <tbody>
                            <tr>
                              <td class="fw-bold">Código: </td>
                              <td>{{item._id}}</td>
                            </tr>
                            <tr>
                              <td class="fw-bold">Transacción: </td>
                              <td>{{item.transaccion}}</td>
                            </tr>
                            <tr>
                              <td class="fw-bold">Subtotal: </td>
                              <td>{{item.subtotal}}</td>
                            </tr>
                            <tr>
                              <td class="fw-bold">Plan: </td>
                              <td>{{item.plan}}</td>
                            </tr>
                            <tr>
                              <td class="fw-bold">Fecha de inicio: </td>
                              <td>{{item.createdAt | date}}</td>
                            </tr>
                            <tr>
                              <td class="fw-bold">Fecha de fin: </td>
                              <td>{{item.vencimiento | date}}</td>
                            </tr>
                            <tr>
                              <td class="fw-bold">Estado: </td>
                              <td>{{item.estado}}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal Básico -->
<div class="modal fade" id="reservacionModal" tabindex="-1" aria-labelledby="reservacionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="reservacionModalLabel">Reservar suscripción</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center">

          <div class="row d-flex justify-content-center">
            <div class="col-12 col-sm-6">
              Tienes un código de referido? &nbsp;

              <a data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false"
                aria-controls="collapseExample">
                <i class="bi bi-info-circle"></i>
              </a>
              <div class="collapse" id="collapseExample">
                <div class="card card-body">
                  <p>
                    Es un código de 6 dígitos que se le proporciona a un usuario registrado
                    que permite a usuarios nuevos a acceder a un descuento del <strong class="text-success fs-5">10%
                    </strong> en cualquiera de nuestro planes.
                  </p>
                </div>
              </div>

              <!-- <div class="input-group my-3">
                <input type="text" class="form-control" placeholder="Ingrese el código" name="codigo_referido"
                  id="codigo_referido" [(ngModel)]="codigo_referido" aria-label="Ingrese el código"
                  aria-describedby="button-addon2" maxlength="6">
                <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                  (click)="verificar_codigo_referido()" [disabled]="verificado">
                  Verificar
                </button>
              </div> -->
            </div>
          </div>

          Realizar un pago de
          <h1 class="fw-bold text-success">S/. 20</h1>
          A una de las siguientes cuentas
        </div>

        <div class="" *ngIf="!load_data">
          <ng-container *ngFor="let item of cuentas">
            <div class="shadow rounded px-3 my-3 py-3" [ngStyle]="{'background-color': item.color}">
              <div class="row pt-3">
                <div class="text-center">
                  <h5 class="fw-bold">
                    {{item.banco}}
                  </h5>
                </div>
              </div>

              <div class="row text-center">
                <div class="col-md-4 col-12">
                  <span class="badge rounded-pill text-bg-light"><strong>Titular: </strong>
                    {{item.titular}}</span>
                </div>

                <div class="col-md-4 col-12">
                  <span class="fs-6 mx-3"> <strong>Cuenta: </strong> {{item.cuenta}}</span>
                </div>

                <div class="col-md-4 col-12">
                  <span class="fs-6 mx-3"> <strong>CCI: </strong> {{item.cci}}</span>
                </div>
              </div>
            </div>

          </ng-container>
        </div>

        <div class="text-danger">
          <strong>Recuerde: </strong>
          La reservación no asegura su suscripción, éste se dará cuando hayamos verificado su pago!
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="crear_reservacion()">
          <i class="bi bi-bookmark-heart"></i> &nbsp;
          Reservar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Premium -->
<div class="modal fade" id="resPremuim" tabindex="-1" aria-labelledby="resPremuimLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="resPremuimLabel">Reservar suscripción premium</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center">

          <div class="row d-flex justify-content-center">
            <div class="col-12 col-sm-6">
              Tienes un código de referido? &nbsp;

              <a data-bs-toggle="collapse" data-bs-target="#collapseExample1" aria-expanded="false"
                aria-controls="collapseExample1">
                <i class="bi bi-info-circle"></i>
              </a>
              <div class="collapse" id="collapseExample1">
                <div class="card card-body">
                  <p>
                    Es un código de 6 dígitos que se le proporciona a un usuario registrado
                    que permite a usuarios nuevos a acceder a un descuento del <strong class="text-success fs-5">10%
                    </strong> en cualquiera de nuestro planes.
                  </p>
                </div>
              </div>

              <!-- <div class="input-group my-3">
                <input type="text" class="form-control" placeholder="Ingrese el código" name="codigo_referido"
                  id="codigo_referido" [(ngModel)]="codigo_referido" aria-label="Ingrese el código"
                  aria-describedby="button-addon2" maxlength="6">
                <button class="btn btn-outline-secondary" type="button" id="button-addon2"
                  (click)="verificar_codigo_referido()" [disabled]="verificado">Verificar</button>
              </div> -->
            </div>
          </div>

          Realizar un pago de
          <h1 class="fw-bold text-success">S/. 30</h1>
          A una de las siguientes cuentas
        </div>

        <div class="" *ngIf="!load_data">
          <ng-container *ngFor="let item of cuentas">
            <div class="shadow rounded px-3 my-3 py-3" [ngStyle]="{'background-color': item.color}">
              <div class="row pt-3">
                <div class="text-center">
                  <h5 class="fw-bold">
                    {{item.banco}}
                  </h5>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4 col-12">
                  <span class="badge rounded-pill text-bg-light"><strong>Titular: </strong>
                    {{item.titular}}</span>
                </div>

                <div class="col-md-4 col-12">
                  <span class="fs-6 mx-3"> <strong>Cuenta: </strong> {{item.cuenta}}</span>
                </div>

                <div class="col-md-4 col-12">
                  <span class="fs-6 mx-3"> <strong>CCI: </strong> {{item.cci}}</span>
                </div>
              </div>
            </div>

          </ng-container>
        </div>

        <div class="text-danger">
          <strong>Recuerde: </strong>
          La reservación no asegura su suscripción, éste se dará cuando hayamos verificado su pago!
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
          <i class="bi bi-bookmark-heart"></i> &nbsp;
          Reservar
        </button>
      </div>
    </div>
  </div>
</div>